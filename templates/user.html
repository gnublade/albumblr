{% extends "base.html" %}

{% block title %}{{ username }}{% endblock %}

{% block headextra %}
<link type="text/css" href="http://jqueryui.com/latest/themes/base/ui.all.css" rel="stylesheet" />
{% endblock %}

{% block content %}
<div id="user-badge">
<div id="badge-avatar"><img src="{{ avatar }}" /></div>
<div id="badge-head"><h2>{{ username }}'s Albums</h2></div>
<div id="badge-info">
    <strong class="fn">{{ realname }}</strong>,
    {{ age }}, {{ gender }}, {{ country }}
</div>
</div>

<div id="tabs" class="clearit">
<ul>
    <li><a href="#wanted-albums">Would Like</a></li>
    <li class="selected"><a href="#owned-albums">Owned</a></li>
    <li><a href="#recommended-artist-albums">By Recommended Artists</a></li>
</ul>

<div id="wanted-albums">
<p>
Based on the albums {{ username }}'s got we think you would like the following
albums:
</p>
<ul id='wanted-album-list'>
    {% for album in albums.wanted %}
    <li>{{ album }}</li>
    {% endfor %}
</ul>
</div>

<div id="owned-albums">
<p>
Below is a list of albums that I think you own, whether on CD or some other
format.  If this is your first visit to Albumblr it might take me a little
while to figure this out so please be patient, refreshing just makes Google
angry!
</p>
<ul id='owned-album-list'>
    {% for album in albums.owned %}
    <li>{{ album }}</li>
    {% endfor %}
</ul>
</div>

<div id="recommended-artist-albums">
<p>
These are some artists recommended to {{ username }}, probably best taken with
a pinch of salt.
</p>
</div>
{% endblock %}

{% block bodyscript %}
<script src="http://www.google.com/jsapi"></script>
<script>
google.load("jquery", "1.3.2");
google.load("jqueryui", "1.7.2");
function populateAlbumList(ul, albums) {
    ul.empty();
    for (var i = 0; i < albums.length; i++) {
        ul.append("<li>" + albums[i] + "</li>");
    }
}
function updateAlbums(url, containerId) {
    $.getJSON(url, function (data) {
        if (data) {
            populateAlbumList($(containerId), data);
            if (data.length < 10) {
                updateAlbums(url, containerId);
            }
        }
    });
}
var tabs = [
    [ "albums/wanted", "#wanted-album-list" ],
    [ "albums/owned", "#owned-album-list" ],
    [ "albums/recommended", "#recommended-album-list" ],
];
function selectTab(event, ui) {
    var tab = tabs[ui.index];
    var url = tab[0];
    var containerId = tab[1];
    if ($(containerId).children().length < 10) {
        updateAlbums(url, containerId);
    }
}
google.setOnLoadCallback(function() {
    var tabs = $("#tabs").tabs({ select: selectTab });
    selectTab(null, { index: 0 });
});
</script>
<script type="text/javascript" src="http://jqueryui.com/latest/ui/ui.tabs.js"></script>
{% endblock %}
