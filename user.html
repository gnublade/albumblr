<html>
    <head>
        <title>Albumblr - {{ username }}</title>
    </head>

    <body>
        <h1>Albumblr - {{ username }}</h1>
        <ul id='album-list'>
            {% for album in albums %}
            <li>{{ album }}</li>
            {% endfor %}
        </ul>
    </body>
    <script src="http://www.google.com/jsapi"></script>
    <script>
        google.load("jquery", "1.3.2");
        function populateAlbumList(albums) {
            $("#album-list").empty();
            for (var i = 0; i < albums.length; i++) {
                $("#album-list").append("<li>" + albums[i] + "</li>");
            }
        }
        var processed = 0;
        function checkStatus() {
            $.getJSON("albums/status",
                function (s) {
                    if (s.processed > processed) {
                        processed = s.processed;
                        $.getJSON("albums/owned", populateAlbumList);
                    }
                    if (s && s.processed < s.processing) {
                        setTimeout('checkStatus()', 10000);
                    }
                });
        }
        google.setOnLoadCallback(function() {
            checkStatus();
        });
    </script>
</html>
